- hosts: controller
  roles:
    - run-devstack
    - run-contrail
  tasks:
    - name: Install Python3
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - "python3"
        - "python3-pip"
        - "python3-dev"
        - "python3-setuptools"

    - name: Execute noc-integration testing
      shell: |
        export CONTROLLER_IP={{ hostvars['controller'].ansible_default_ipv4.address }}
        tox -vv -e integration
      args:
        chdir: "{{ zuul.project.src_dir }}"
        executable: /bin/bash

    - name: Pause execution to make sure workers flushed all logs before stoping
      pause:
        seconds: 30
