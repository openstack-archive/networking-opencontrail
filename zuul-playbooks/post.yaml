- hosts: all
  roles:
    - export-devstack-journal
    - devstack-project-conf
    - capture-system-logs
    - fetch-devstack-log-dir
  tasks:
    - name: Fetch contrail logs
      become: yes
      synchronize:
        src: "/var/log/contrail"
        dest: "{{ zuul.executor.log_root }}/controller/logs"
        mode: pull
    - name: Fetch contrail-ansible-deployer config files
      become: yes
      synchronize:
        src: "/home/zuul/contrail-ansible-deployer/{{ item }}"
        dest: "{{ zuul.executor.log_root }}/controller/logs/contrail/{{ item }}"
        mode: pull
        recursive: yes
      with_items:
        - "config"
        - "inventory"
    - name: Fetch docker config files
      become: yes
      synchronize:
        src: "/etc/docker"
        dest: "{{ zuul.executor.log_root }}/controller/logs"
        mode: pull
    - name: List running containers
      become: yes
      register: running_containers_list
      shell: "docker ps --format={% raw %}'{{.Names}}: {{.Status}}'{% endraw %}"
