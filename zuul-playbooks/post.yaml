- hosts: all
  roles:
    - export-devstack-journal
    - devstack-project-conf
    - capture-system-logs
    - fetch-devstack-log-dir
  tasks:
    - set_fact:
      contrail_dirs:
        'config': "{{ ansible_env.HOME }}/contrail-ansible-deployer"
        'logs': "/var/log/contrail"
    - name: Fetch contrail-ansible-deployer instances file
      become: yes
      synchronize:
        src: "{{ contrail_dirs.config }}/{{ item }}"
        dest: "{{ zuul.executor.log_root }}/contrail-ansible-deployer/config/{{ item }}"
        mode: pull
        recursive: yes
      with_items:
        - "config/instances.yaml"
        - "inventory/hosts"
        - "ansible.cfg"
      ignore_errors: yes
    - name: Fetch contrail logs
      become: yes
      synchronize:
        src: "{{ contrail_dirs.logs }}"
        dest: "{{ zuul.executor.log_root }}/contrail-ansible-deployer/logs"
        mode: pull
    - name: List running containers
      command: 'docker ps --format "{{.Names}}: {{.Status}}"'
      register: running_containers_list
