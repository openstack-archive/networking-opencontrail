- hosts: all
  roles:
    - role: export-devstack-journal
      ignore_errors: yes
    - role: devstack-project-conf
      ignore_errors: yes
    - role: capture-system-logs
      ignore_errors: yes
    - role: fetch-devstack-log-dir
      ignore_errors: yes
  tasks:
    - name: Fetch contrail logs
      become: yes
      synchronize:
        src: "/var/log/contrail"
        dest: "{{ zuul.executor.log_root }}/controller/logs"
        mode: pull
    - name: Fetch contrail-ansible-deployer config files
      become: yes
      synchronize:
        src: "/home/zuul/contrail-ansible-deployer/{{ item }}"
        dest: "{{ zuul.executor.log_root }}/controller/logs/contrail/{{ item }}"
        mode: pull
        recursive: yes
      with_items:
        - "config"
        - "inventory"
    - name: Fetch docker config files
      become: yes
      synchronize:
        src: "/etc/docker"
        dest: "{{ zuul.executor.log_root }}/controller/logs"
        mode: pull
    - name: List running containers
      become: yes
      shell: |
        set -e
        set -x
        mkdir -p {{ zuul.executor.log_root }}/controller/logs/docker
        docker ps --format={% raw %}'{{.Names}}: {{.Status}}'{% endraw %} | tee {{ zuul.executor.log_root }}/controller/logs/docker/containers.txt
